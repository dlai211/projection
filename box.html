<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Box Motion Animation</title>
    <link href="https://fonts.googleapis.com/css2?family=Finger+Paint&display=swap" rel="stylesheet">
    <style>
        h1 {
            color: #FFEEAD;           
            margin-bottom: 20px;
            font-family: 'Finger Paint', cursive;
            font-size: 4vh;
        }
        body {
            background-color: #96CEB4;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        canvas {
            border: 2px solid #A66E38;
            background-color: #F2E5BF;
            width: 90vh;
            height: 70vh;
            /* width: 40vh;
            height: 30vh; */
        }

        label {
            display: inline-block;
            flex-direction: column;
            align-items: center;
            font-size: 2vh;
            margin-right: 10px;
            font-family: 'Finger Paint', cursive;
            color: #FFEEAD;
            text-shadow: 1px 1px darkgrey;
        }

        input[type="range"] {
            -webkit-appearance: none;
            }

        input[type="range"]:focus {
            outline: none;
            }


        input[type="range"]::-webkit-slider-runnable-track {
            background: tomato;
            height: 5px;
            }

        input[type="range"]::-moz-range-track {
            background: tomato;
            height: 5px;
            }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 15px;
            width: 15px;
            background: pink;
            margin-top: -5px;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            height: 15px;
            width: 15px;
            background: pink;
            margin-top: -5px;
            border-radius: 50%;
        }

        button, .file-input-label {
            display: inline-block;
            background-color: rgb(255, 255, 213);
            font-size: 2vh;
            padding: 5px 10px 5px 12px;
            border: black 1.5px solid;
            border-radius: 5px;
            margin: 2vh 2vh 2vh 2vh;
            font-family: 'Finger Paint', cursive;
            /* text-shadow: 1px 1px black; */
            cursor: pointer;
        }
        
        @media (min-width: 768px) {
            button, .file-input-label {
                font-size: 2vh;
            }
        }
    </style>
</head>
<body>
    <h1>Box Motion Animation</h1>
    <canvas id="boxCanvas" width="800" height="600"></canvas>
    <div id="controls">
        <label for="angleSlider"> Slope Angle: </label>
        <input type="range" id="angleSlider" min="-45" max="45" step="5" value="0"> <span id="angleValue">0°</span>
        <br>
        <label for="frictionSlider"> Friction Coefficient: </label>
        <input type="range" id="frictionSlider" min="0" max="1" step="0.1" value="0.3"> <span id="frictionValue">0.3</span>
        <br>
        <label for="initialForceSlider"> Initial Force: </label>
        <input type="range" id="initialForceSlider" min="0" max="50" step="5" value="0"> <span id="initialForceValue">0</span>
        <br>
        <label for="continuousForceSlider"> Continuous Force: </label>
        <input type="range" id="continuousForceSlider" min="0" max="50" step="5" value="0"> <span id="continuousForceValue">0</span>
        <br>
        <label for="forceAngleSlider"> Force Angle: </label>
        <input type="range" id="forceAngleSlider" min="-45" max="45" step="5" value="0"> <span id="forceAngleValue">0°</span>
        <br>

        <button onclick="position()">P</button>
        <button onclick="velocity()">V</button>
        <button onclick="acceleration()">A</button>
        <button onclick="force()">F</button>
        <button onclick="reset()">R</button>
    </div>
    <script>
        const canvas = document.getElementById('boxCanvas');
        const ctx = canvas.getContext('2d');
        const angleSlider = document.getElementById('angleSlider');
        const frictionSlider = document.getElementById('frictionSlider');
        const angleValue = document.getElementById('angleValue');
        const frictionValue = document.getElementById('frictionValue');
        const initialForceSlider = document.getElementById('initialForceSlider');
        const initialForceValue = document.getElementById('initialForceValue');
        const continuousForceSlider = document.getElementById('continuousForceSlider');
        const continuousForceValue = document.getElementById('continuousForceValue');
        const forceAngleSlider = document.getElementById('forceAngleSlider');
        const forceAngleValue = document.getElementById('forceAngleValue');

        let showPosition = false;
        let showVelocity = false;
        let showAcceleration = false;
        let showForce = false;

        let box = {
            x: ctx.canvas.width / 2 - 25,
            y: ctx.canvas.height / 2 - 25,
            width: 50,
            height: 50,
            velocityX: 0,
            velocityY: 0
        };
        const Scale = 300;
        const gravity = -9.81; // m/s^2
        // const maxX = 80000;
        // const maxY = 60000;
        // function scaleX(value) {
        //     return value / maxX * canvas.width;
        // }
        // function scaleY(value) {
        //     return value / maxY * canvas.height;
        // }

        function drawArrow(fromX, fromY, toX, toY, color) {
            const headLength = 10; // Length of the arrowhead
            const dx = toX - fromX;
            const dy = toY - fromY;
            const angle = Math.atan2(dy, dx);

            // Draw the line
            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw the arrowhead
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6));
            ctx.lineTo(toX, toY);
            ctx.fillStyle = color;
            ctx.fill();
        }

        function drawSlope(angle) {
            ctx.beginPath();
            ctx.moveTo(0, canvas.height/2);
            ctx.lineTo(canvas.width, canvas.height/2 - Math.tan(angle * Math.PI / 180) * canvas.width);
            ctx.stroke();
        }

        function drawBox(angle) {
            ctx.save();
            ctx.translate(0, canvas.height / 2);

            const angleRadian = angle * Math.PI / 180;
            ctx.rotate(-angleRadian);

            ctx.translate(box.x, 0);   

            ctx.fillStyle = '#257180';
            ctx.fillRect(0, -box.height, box.width, box.height);

            ctx.restore();
        }


        function updateBoxPosition(angle, friction, initialForce, continuousForce, forceAngle) {
            let angleRadian = angle * Math.PI / 180;
            let acceleration = gravity * Math.sin(angleRadian);
            let frictionForce = null;
            let inititalForce = null;
            // console.log(acceleration, frictionForce);

            box.velocityX += acceleration;

            if (box.velocityX != 0) { 
                frictionForce = Math.sign(box.velocityX) * friction * gravity * Math.cos(angleRadian);
                box.velocityX += frictionForce;
            }

            box.x += box.velocityX / Scale;

            if (Math.abs(box.x) > canvas.width) {
                box.x = canvas.width / 2 - 25;
                box.y = canvas.width / 2 - 25;
                box.velocityX = 0;
                box.velocityY = 0;
            }

            // Calculate the new y position based on the slope
            box.y = canvas.height/2 - Math.tan(angleRadian) * box.x - box.height;
        }

        function updateCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const angle = parseFloat(angleSlider.value);
            const friction = parseFloat(frictionSlider.value);
            const initialForce = parseFloat(initialForceSlider.value);
            const continuousForce = parseFloat(continuousForceSlider.value);
            const forceAngle = parseFloat(forceAngleSlider.value);
            drawSlope(angle);
            updateBoxPosition(angle, friction, initialForce, continuousForce, forceAngle);
            drawBox(angle);
            if (showForce) {
                drawForce(angle);
            }
        }
 
        function animate() {
            updateCanvas();
            requestAnimationFrame(animate);

        }

        function force() {
            showForce = !showForce;
        }

        function drawForce(angle) {
            const angleRadian = angle * Math.PI / 180;
    
            const gravityLength = 50; 
            const gravityX = box.x + box.width / 2;
            const gravityY = box.y + box.height / 2; 
            
            drawArrow(gravityX, gravityY, gravityX, gravityY + gravityLength, 'blue'); 

            const normalLength = 50; 
            const normalX = gravityX; 
            const normalY = gravityY;

            const normalXEnd = normalX - normalLength * Math.sin(angleRadian);
            const normalYEnd = normalY - normalLength * Math.cos(angleRadian);
            
            drawArrow(normalX, normalY, normalXEnd, normalYEnd, 'red'); 
        }
        function reset() {
            // showPosition = false;
            // showVelocity = false;
            // showAcceleration = false;
            animate();
        }

        // Event listeners for sliders
        angleSlider.addEventListener('input', () => {
            angleValue.textContent = `${angleSlider.value}°`;
        });

        frictionSlider.addEventListener('input', () => {
            frictionValue.textContent = `${frictionSlider.value}`;
        });

        initialForceSlider.addEventListener('input', () => {
            initialForceValue.textContent = `${initialForceSlider.value}`;
        });

        continuousForceSlider.addEventListener('input', () => { 
            continuousForceValue.textContent = `${continuousForceSlider.value}`;
        });

        forceAngleSlider.addEventListener('input', () => {  
            forceAngleValue.textContent = `${forceAngleSlider.value}`;
        });

        // Start animation
        animate();
    </script>
</body>
